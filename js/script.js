function wrapCharacters(e,n){$(e).contents().each(function(){if(1===this.nodeType)wrapCharacters(this);else if(3===this.nodeType){var e=this.nodeValue.trim();$(this).replaceWith($.map(e.split(""),n).join(""))}})}function ShuffleHandwrittenText(e){"en-US"===$("html").attr("lang")&&wrapCharacters(e,function(e){var n=Math.ceil(3*Math.random());return"9"==e&&(n=2),'<span class="font-hand-'+n+'">'+e+"</span>"})}function locale(){return window.document.getElementsByTagName("html")[0].lang.replace("-","_")}function fetchNewRound(e,n,t){var r=this;n||(n=[]);var o=function(){var o=new Translations($("html").attr("lang"));PopupView.showErrorPopup(o.getPhrase("communication_error"),o.getPhrase("try_again")).then(function(){return r.fetchNewRound(e,n,t)})};$.ajax({method:"post",url:"/api",data:{method:"newround",bwords:n.join(","),locale:locale(),edition:config.edition},dataType:"json"}).done(function(e){if(!e.challenge)throw o(),new Error("Challenge missing from server response",e);__currentuid=e.uid,t(e)}).fail(function(e){throw o(),new Error("Could not fetch new round from server",e)})}function fetchGallery(e){return new Promise(function(n,t){$.ajax({method:"post",url:"/api",dataType:"json",data:{method:"gallery",word:e,locale:locale(),edition:config.edition}}).done(function(e){e.images?n(e.images):t("Could not fetch gallery")})})}function generateShareUrl(e){var n=new Translations($("html").attr("lang"));return new Promise(function(t,r){$.ajax({method:"post",url:"/api",dataType:"json",data:{method:"share",rounds:JSON.stringify(e),locale:locale(),edition:config.edition}}).done(function(e){t(e)}).fail(function(e){PopupView.showErrorPopup(n.getPhrase("share_error"),n.getPhrase("try_again")),r(e)})})}function sendResult(e,n){var t=1;return e.level>3&&(t=2),new Promise(function(r,o){$.ajax({method:"post",url:"/api",dataType:"json",data:{method:"roundresult",uid:__currentuid,round:e.level,image:JSON.stringify(e.drawing),word:e.word,duration:e.getElapsedTime(),level:t,recognized:e.recognized,recognitionId:e.recognitionId,bwords:n.join(","),locale:locale(),edition:config.edition}}).done(function(e){e.challenge||o(new Error("Challenge missing from server response",e)),__currentuid=e.uid,r(e)}).fail(function(){fetchNewRound(e.level+1,n,r)})})}function submitSurvey(e){return new Promise(function(n,t){e.method="survey",$.ajax({method:"post",url:"/api",dataType:"json",data:e})})}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var classCallCheck=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),inherits=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)},possibleConstructorReturn=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n},toConsumableArray=function(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)},EventEmitter=function(){function e(){classCallCheck(this,e),this.listeners={}}return createClass(e,[{key:"addListener",value:function(e,n){_.has(this.listeners,e)||(this.listeners[e]=[]),this.listeners[e].push(n)}},{key:"isFunction",value:function(e){return"function"==typeof e||!1}},{key:"removeListener",value:function(e,n){var t=this,r=this.listeners[e],o=void 0;return!!(r&&r.length&&(o=r.reduce(function(e,r,o){return t.isFunction(r)&&r===n?e=o:e},-1))>-1)&&(r.splice(o,1),this.listeners[e]=r,!0)}},{key:"emit",value:function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];var o=this.listeners[e];return!(!o||!o.length)&&(o.forEach(function(e){e.apply(void 0,t)}),!0)}}]),e}(),config={site_url:"quickdraw.withgoogle.com",handwriting_url:"https://inputtools.google.com/request?ime=handwriting&app=quickdraw&dbg=1&cs=1&oe=UTF-8",handwriting_threshold:4,handwriting_recognition_threshold:2,round_length:20,num_rounds:6,max_api_rate:1,gameSplashscreenTimeout:20,userNotDrawingTimeout:7,noNewGuessesSentences:["no_clue","not_sure","stumped"],timesUpSentences:["sorry"],userNotDrawingSentences:["cant_guess","start_drawing"]},SVGUtils=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"createSvg",value:function(e,n){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("width",e),t.setAttribute("height",n),t}},{key:"createLinePath",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#000000";if(0!=e.length&&0!=e[0].length){for(var a=function(e,r){return(e-n[r])*t},i=document.createElementNS("http://www.w3.org/2000/svg","path"),s="M"+a(e[0][0],0)+" "+a(e[1][0],1),u=1;u<e[0].length;u++)s+=" L"+a(e[0][u],0)+" "+a(e[1][u],1);return i.setAttribute("d",s),i.setAttribute("stroke",o),i.setAttribute("stroke-width",r),i.setAttribute("stroke-linecap","round"),i.setAttribute("fill","none"),i}}},{key:"calculateBoundingBox",value:function(e){for(var n=-1,t=-1,r=-1,o=-1,a=0;a<e.length;a++)for(var i=0;i<e[a][0].length;i++)(-1==n||n>e[a][0][i])&&(n=e[a][0][i]),(-1==t||t<e[a][0][i])&&(t=e[a][0][i]),(-1==r||r>e[a][1][i])&&(r=e[a][1][i]),(-1==o||o<e[a][1][i])&&(o=e[a][1][i]);return{x:n-5,y:r-5,w:t-n+10,h:o-r+10}}},{key:"createSvgFromSegments",value:function(n,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};o=_.defaults(o,{padding:0,order:0,color:"#000000"});var a=[];if(1==o.order)for(var i=0;i<n.length;i++){for(var s=[[],[]],u=0;u<n[i].length;u++)s[0].push(n[i][u][0]),s[1].push(n[i][u][1]);a.push(s)}else n&&(a=n);t-=2*o.padding,r-=2*o.padding;var c=2*t/140,l=e.createSvg(t,r),d=e.calculateBoundingBox(a),h=t/r,p=[d.x,d.y],g=void 0;d.w/d.h>h?(g=t/d.w,p[1]-=.5*(r/g-d.h)):(g=r/d.h,p[0]-=.5*(t/g-d.w));for(var w=0;w<a.length;w++)l.appendChild(e.createLinePath(a[w],p,g,c,o.color));return o.padding&&$(l).addClass("svg-margin-"+o.padding),l}}]),e}(),_hashManager_instance,HashManager=function(){function e(){return classCallCheck(this,e),_hashManager_instance||(_hashManager_instance=this,_hashManager_instance.queue=[],window.onhashchange=function(){var n=location.hash.replace("#","");0!=_hashManager_instance.queue.length&&n==_.last(_hashManager_instance.queue).name||(_hashManager_instance.queue.length>1&&n==_hashManager_instance.queue[_hashManager_instance.queue.length-2].name||0==n.length&&1==_hashManager_instance.queue.length)&&(_.last(_hashManager_instance.queue).callback&&_.last(_hashManager_instance.queue).callback(),e.pop(_.last(_hashManager_instance.queue).name))},location.hash=""),_hashManager_instance}return createClass(e,null,[{key:"push",value:function(e,n){_.last(_hashManager_instance.queue)&&_.last(_hashManager_instance.queue).name==e||(_hashManager_instance.queue.push({name:e,callback:n}),location.hash=e)}},{key:"pop",value:function(e){_.last(_hashManager_instance.queue)&&_.last(_hashManager_instance.queue).name==e&&(_hashManager_instance.queue.pop(),_hashManager_instance.queue.length>0?location.hash=_.last(_hashManager_instance.queue).name:location.hash="")}}]),e}();_hashManager_instance=new HashManager;var phrases={ar:{i_see:"أرى شكل",or:"أو",oh_i_know:"لقد عرفت، هذا %(word)!",drawing:"الرسم",something_else:"لقد رأت الشبكة العصبية في رسوماتك أشكالًا تختلف عمّا أردت رسمه. اختر إحدى الرسومات لمعرفة ما رأته.",no_clue:"ليس لدي أدنى فكرة عمّا ترسمه!",not_sure:"لست متاكّدة من أنّني أعرف هذا الشكل.",stumped:"أنا حائرة.",sorry:"عذرًا، لم أتمكن من التعرّف على هذا الرسم.",cant_guess:"كيف لي أن أتعرّف على ما ترسمه إذا لم ترسم أي شكل!",start_drawing:"حان الوقت لتبدأ بالرسم.",draw:"ارسم شكل %(word)",what_it_saw:"لقد تعرّفت الشبكة العصبية على %(num_correct) من الأشكال التي رسمتها، <br> لكنها رأت أشكالًا تختلف عمّا أردت رسمه في %(num_wrong) من رسوماتك الأخرى.<br>اختَر إحداها لرؤية ما رأته.",how:"لقد تعرّفت الشبكة العصبية على %(num_correct) من الأشكال التي رسمتها، <br>اختر إحداها لرؤية كيف تم التعرّف عليها.",correct_match:"تطابق صحيح",closest_match:"الشكل الأقرب",learned_by_example:"كيف يمكن للشبكة العصبية التعرّف على شكل %(word)؟ <br> لقد تعلّمت من خلال النظر إلى هذه الأمثلة التي رسمها اللاعبون الآخرون.",what_does_it_think:"كيف يبدو باعتقادها شكل %(word)؟ <br> لقد تعلمت من خلال النظر إلى هذه الأمثلة التي رسمها أشخاص آخرون.",share:'هل بإمكان الشبكة العصبية تعلُّم التعرُّف على الرسوم؟ جّرب لعبة "Quick, Draw" لمعرفة الإجابة.',share_portfolio:"لقد رسمتُ ست رسومات، وتعرّفَتْ الشبكة العصبية على %(num_correct) منها بشكل صحيح.",share_portfolio_desc:"كم رسم من رسوماتك يمكن للشبكة العصبية الاصطناعية التعرُّف عليه؟",preparing:"جارٍ التحضير للمشاركة...",communication_error:"حصل خطأ في التواصل مع خادم اللعبة",try_again:"حاول مرة أخرى",share_error:"حصل خطأ أثناء التحضير للمشاركة",reload:"إعادة تحميل",well_drawn:"أحسنت في الرسم!",oops:"حصل خطأ!",none:"ولا أيّ واحد",one:"واحد",two:"اثنان",three:"ثلاثة",four:"أربعة",five:"خمسة",all:"كلّها",popup_share:"مشاركة",popup_share_ready:"جاهزة للمشاركة"},de:{i_see:"Ich sehe",or:"oder",oh_i_know:'Ah, jetzt weiß ich es: "%(word)"!',drawing:"Zeichnung",something_else:"Unser neuronales Netzwerk erkannte in allen deinen Zeichnungen etwas anderes. Wähl eine aus, um zu erfahren, was das genau war.",no_clue:"Keine Ahnung, was du da zeichnest!",not_sure:"Ich bin mir nicht sicher, was das sein soll.",stumped:"Ich bin ratlos.",sorry:"Das konnte ich leider nicht erraten.",cant_guess:"Wie soll ich raten, wenn du nicht zeichnest!",start_drawing:"Fang schon mit dem Zeichnen an.",draw:"Zeichne: %(word)",what_it_saw:"Unser neuronales Netzwerk hat %(num_correct) deiner Zeichnungen erkannt. <br>In den anderen %(num_wrong) Zeichnungen erkannte es aber etwas anderes. <br>Wähl eine aus, um zu erfahren, was das genau war.",how:"Unser neuronales Netzwerk hat %(num_correct) deiner Zeichnungen erkannt. <br>Wähl eine aus, um zu erfahren, was das genau war.",correct_match:"Korrekte Übereinstimmung",closest_match:"Genaueste Übereinstimmung",learned_by_example:'Woher weiß es, wie "%(word)" aussieht?<br> Es hat das gelernt, indem es die Zeichnungen anderer Spieler analysiert hat.',what_does_it_think:'Wie sieht seiner Meinung nach "%(word)" aus?<br> Es hat das gelernt, indem es die Zeichnungen anderer Spieler analysiert hat.',share:'Kann ein neuronales Netzwerk Zeichnungen erkennen? Spiel "Quick, Draw" und find es heraus.',share_portfolio:"Ich habe diese sechs Zeichnungen angefertigt. Ein neuronales Netzwerk hat %(num_correct) von ihnen erkannt.",share_portfolio_desc:"Wie viele deiner Zeichnungen kann ich erraten?",preparing:"Teilen wird vorbereitet…",communication_error:"Bei der Kommunikation mit dem Spielserver ist ein Fehler aufgetreten.",try_again:"Noch einmal versuchen",share_error:"Beim Vorbereiten auf das Teilen ist ein Fehler aufgetreten.",reload:"Neu laden",well_drawn:"Gut gezeichnet!",oops:"hoppla",none:"keine",one:"eine",two:"zwei",three:"drei",four:"vier",five:"fünf",all:"alle",popup_share:"Teilen",popup_share_ready:"Bereit zum Teilen"},en_US:{i_see:"I see",or:"or",oh_i_know:"Oh I know, it's %(word)!",drawing:"Drawing",something_else:"Our neural net saw something else in all of your doodles. Select one to see what it saw.",no_clue:"I have no clue what you're drawing!",not_sure:"I'm not sure what that is.",stumped:"I'm stumped.",sorry:"Sorry, I couldn't guess it.",cant_guess:"I can't guess what you're drawing if you don't draw!",start_drawing:"It's time for you to start drawing.",draw:"Draw: %(word)",what_it_saw:'Our neural net figured out %(num_correct) of your doodles. <br>But it saw something else in the other %(num_wrong). <br>Select one to see what it saw, and visit the <a href="https://quickdraw.withgoogle.com/data">data</a> to see 50 million drawings made by other real people on the internet.',how:'Our neural net figured out %(num_correct) of your doodles. <br>Select one to see how it figured it out, and visit the <a href="https://quickdraw.withgoogle.com/data">data</a> to see 50 million drawings made by other real people on the internet.',correct_match:"Correct match",closest_match:"Closest match",learned_by_example:"How does it know what %(word) looks like?<br> It learned by looking at these examples drawn by other people.",what_does_it_think:"What does it think %(word) looks like?<br> It learned by looking at these examples drawn by other people.",share:"Can a neural network learn to recognize your doodles? Play Quick, Draw to find out!",share_portfolio:"I made these six doodles. A neural network guessed %(num_correct) of them correctly.",share_portfolio_desc:"How many of yours can it guess?",preparing:"Preparing to share...",communication_error:"Sorry! Something went wrong communicating with the game server!",try_again:"Try Again",share_error:"Sorry! Something went wrong while preparing for sharing",reload:"Reload",popup_share:"Share",popup_share_ready:"Ready to share",well_drawn:"Well drawn!",oops:"oops",none:"none",one:"one",two:"two",three:"three",four:"four",five:"five",all:"all"},es:{i_see:"Parece",or:"o",oh_i_know:"¡Lo sé, es %(word)!",drawing:"Dibujo",something_else:"Nuestra red neuronal ha pensado que tus dibujos eran otra cosa. Selecciona uno de ellos para saber qué ha reconocido.",no_clue:"¡No tengo ni idea de qué estás dibujando!",not_sure:"No sé qué es eso.",stumped:"Me he bloqueado.",sorry:"No he podido adivinarlo.",cant_guess:"Si no dibujas algo, no puedo adivinarlo.",start_drawing:"Ya puedes empezar a dibujar.",draw:"Dibuja: %(word)",what_it_saw:"Nuestra red neuronal ha adivinado %(num_correct) de tus dibujos. <br>Pero ha visto otra cosa en %(num_wrong) de ellos. <br>Selecciona uno para saber qué ha reconocido.",how:"Nuestra red neuronal ha adivinado %(num_correct) de tus dibujos. <br>Selecciona uno de ellos para ver cómo lo ha hecho.",correct_match:"Opción correcta",closest_match:"opción más parecida",learned_by_example:"¿Cómo ha sabido reconocer %(word)?<br> Lo ha aprendido viendo estos dibujos de otros usuarios.",what_does_it_think:"¿Cómo cree que debería ser %(word)?<br> Lo ha aprendido viendo estos dibujos de otros usuarios.",share:"¿Puede una red neuronal reconocer tus dibujos? Juega a Quick, Draw para averiguarlo.",share_portfolio:"He hecho estos seis dibujos y una red neuronal ha adivinado %(num_correct) de ellos.",share_portfolio_desc:"¿Cuántos de los tuyos puede acertar?",preparing:"Preparando para compartir...",communication_error:"Se ha producido un error de comunicación con el servidor del juego.",try_again:"Reintentar",share_error:"Se ha producido un error al preparar el contenido para compartirlo",reload:"Volver a cargar",well_drawn:"¡Muy bien!",oops:"vaya",none:"cero",one:"uno",two:"dos",three:"tres",four:"cuatro",five:"cinco",all:"cada uno",popup_share:"Compartir",popup_share_ready:"Ya puedes compartir la imagen"},es_US:{i_see:"Veo",or:"o",oh_i_know:"¡Ya sé, es %(word)!",drawing:"Dibujo",something_else:"Nuestra red neuronal vio algo más en tus dibujos. Selecciona uno de ellos para descubrir qué vio.",no_clue:"¡No tengo idea de lo que estás dibujando!",not_sure:"No sé bien qué es eso.",stumped:"No tengo idea.",sorry:"Lo siento, pero no pude adivinarlo.",cant_guess:"¡No puedo adivinar si no dibujas nada!",start_drawing:"Comienza a dibujar.",draw:"Dibuja: %(word)",what_it_saw:"Nuestra red neuronal adivinó %(num_correct) de tus dibujos. <br>Sin embargo, vio algo más en otros %(num_wrong). <br>Selecciona uno de ellos para descubrir qué vio.",how:"Nuestra red neuronal adivinó %(num_correct) de tus dibujos. <br>Selecciona uno para descubrir cómo se dio cuenta.",correct_match:"Acierto",closest_match:"coincidencia más cercana",learned_by_example:"¿Cómo sabe reconocer %(word)?<br> Aprendió de estos ejemplos que dibujaron otras personas.",what_does_it_think:"¿Cómo cree que es %(word)?<br> Aprendió de estos ejemplos que dibujaron otras personas.",share:"¿Es posible que una red neuronal aprenda a reconocer tus dibujos? ¡Juega a Quick, Draw para descubrirlo!",share_portfolio:"Hice estos seis dibujos y una red neuronal adivinó %(num_correct)s correctamente.",share_portfolio_desc:"¿Cuántos de los tuyos puede adivinar?",preparing:"Preparando para compartir…",communication_error:"Se produjo un error de comunicación con el servidor del juego",try_again:"Reintentar",share_error:"Se produjo un error al preparar para compartir",reload:"Volver a cargar",well_drawn:"¡Excelentes dibujos!",oops:"uy",none:"ninguno",one:"uno",two:"dos",three:"tres",four:"cuatro",five:"cinco",all:"todos",popup_share:"Compartir",popup_share_ready:"Lista para compartir"},fr:{i_see:"Je vois",or:"ou",oh_i_know:"Oh, je sais, c'est %(word) !",drawing:"Dessin",something_else:"Notre réseau de neurones n'a reconnu aucun de vos dessins. Sélectionnez-en un pour savoir ce qu'il a vu.",no_clue:"Je n'ai aucune idée de ce que vous êtes en train de dessiner !",not_sure:"Je ne suis pas sûr de ce que c'est.",stumped:"Je sèche.",sorry:"Désolé, mais je n'ai pas réussi à deviner ce que c'est.",cant_guess:"Je ne peux pas deviner ce que vous dessinez s'il n'y a rien !",start_drawing:"C'est le moment de dessiner quelque chose.",draw:"Dessinez : %(word)",what_it_saw:"Sur l'ensemble de vos dessins, notre réseau de neurones en a reconnu&nbsp;%(num_correct), mais il en a mal identifié %(num_wrong). <br>Sélectionnez-en un pour savoir ce qu'il a vu.",how:"Notre réseau de neurones a reconnu %(num_correct) de vos dessins. <br>Sélectionnez-en un pour savoir comment il a fait.",correct_match:"Résultat correct",closest_match:"Résultat le plus proche",learned_by_example:"Comment sait-il à quoi ressemble %(word) ?<br> Il l'a appris en regardant ces dessins d'autres personnes.",what_does_it_think:"À quoi pense-t-il que ressemble %(word) ?<br> Il l'a appris en regardant ces dessins d'autres personnes.",share:'Un réseau de neurones peut-il apprendre à reconnaître vos dessins ? Jouez à "Quick, Draw" pour le découvrir !',share_portfolio:"J'ai créé ces six dessins. Un réseau de neurones en a deviné %(num_correct).",share_portfolio_desc:"Combien de dessins pourra-t-il deviner parmi les vôtres ?",preparing:"Préparation du partage…",communication_error:"Désolé, une erreur s'est produite lors de la communication avec le serveur du jeu.",try_again:"Réessayer",share_error:"Désolé, une erreur s'est produite lors de la préparation du partage.",reload:"Actualiser",well_drawn:"Vous êtes un artiste !",oops:"oups",none:"aucun",one:"un",two:"deux",three:"trois",four:"quatre",five:"cinq",all:"tous",popup_share:"Partager",popup_share_ready:"Prête à être partagée"},it:{i_see:"Vedo",or:"oppure",oh_i_know:"Lo so, è %(word)!",drawing:"Disegno",something_else:"La nostra rete neurale ha visto qualcos'altro in tutti i tuoi disegni. Selezionane uno per scoprire cosa ha visto.",no_clue:"Non ho idea di che cosa stai disegnando!",not_sure:"Non sono sicura di cosa sia.",stumped:"Sono confusa.",sorry:"Uffa, non riesco a indovinare.",cant_guess:"Non posso indovinare cosa stai disegnando se non disegni.",start_drawing:"È ora di iniziare a disegnare.",draw:"Disegna: %(word)",what_it_saw:"La nostra rete neurale ha indovinato %(num_correct) dei tuoi disegni. <br>Ma ha visto qualcos'altro in %(num_wrong) altro/i. <br>Selezionane uno per scoprire cosa ha visto.",how:"La nostra rete neurale ha indovinato %(num_correct) dei tuoi disegni. <br>Selezionane uno per scoprire cosa ha visto.",correct_match:"Corrispondenza corretta",closest_match:"corrispondenza migliore",learned_by_example:"Come fa a riconoscere %(word)?<br> Ha imparato esaminando questi esempi disegnati da altre persone.",what_does_it_think:"Come fa a conoscere l'aspetto di %(word)?<br> Ha imparato esaminando questi esempi disegnati da altre persone.",share:"Una rete neurale può imparare a riconoscere i disegni? Gioca a Presto, disegna! per scoprirlo.",share_portfolio:"Ho realizzato questi sei disegni. Una rete neurale ne ha indovinati %(num_correct).",share_portfolio_desc:"Quanti dei tuoi ne riesce a indovinare?",preparing:"Preparazione alla condivisione...",communication_error:"Spiacenti, si è verificato un problema di comunicazione con il server del gioco.",try_again:"Riprova",share_error:"Spiacenti, si è verificato un problema durante la preparazione della condivisione",reload:"Ricarica",well_drawn:"Bei disegni!",oops:"spiacenti",none:"nessuno",one:"uno",two:"due",three:"tre",four:"quattro",five:"cinque",all:"tutti",popup_share:"Condividi",popup_share_ready:"Pronta per la condivisione"},ja:{i_see:"わかりました。",or:"または",oh_i_know:"わかりました。%(word)です！",drawing:"お絵かき",something_else:"1 枚も認識されませんでした。絵を選択すると、それぞれ何の絵と認識されたのかを確認できます。",no_clue:"何が描かれているのかわかりません！",not_sure:"何の絵かわかりません。",stumped:"さっぱりわかりません。",sorry:"すみません。何の絵かわかりませんでした。",cant_guess:"何の絵か当てるので、お絵描きしてみてください。",start_drawing:"お題の絵を描いてみてください。",draw:"%(word)を描いてみてください。",what_it_saw:"%(num_correct) 枚の絵が認識されました。<br>他の %(num_wrong) 枚は認識されませんでした。<br>絵を選択すると、それぞれ何の絵と認識されたのかを確認できます。",how:"%(num_correct) 枚の絵が認識されました。<br>絵を選択すると、それぞれ何の絵と認識されたのかを確認できます。",correct_match:"正解",closest_match:"最も近い絵",learned_by_example:"%(word)の見た目はどのように学んだの？<br> 他の人たちが描いた例を見て学習しました。",what_does_it_think:"なぜ%(word)がどんなものかわかるの？<br> 他の人たちが描いた例を見て学習しました。",share:"ニューラル ネットワークは絵を認識できるようになるでしょうか？Quick, Draw! でチェックしよう。",share_portfolio:"6 枚の絵を描いたところ、ニューラル ネットワークは %(num_correct) 枚正解しました。",share_portfolio_desc:"あなたの絵は何枚当てられるでしょうか？",preparing:"共有の準備をしています...",communication_error:"ゲームサーバーとの通信中にエラーが発生しました。",try_again:"再試行",share_error:"共有の準備中にエラーが発生しました。",reload:"再読み込み",well_drawn:"よくできました！",oops:"残念！",none:"0",one:"1",two:"2",three:"3",four:"4",five:"5",all:"すべて",popup_share:"共有",popup_share_ready:"すぐに共有できます"},ko:{i_see:"뭔지 알 것 같아요.",or:"또는",oh_i_know:"이제 알겠어요. %(word) 맞죠?",drawing:"그림",something_else:"신경망이 낙서를 하나도 알아보지 못했어요. 낙서를 선택하여 신경망이 무엇으로 인식했는지 알아보세요.",no_clue:"무슨 그림인지 전혀 모르겠어요.",not_sure:"무슨 그림인지 잘 모르겠어요.",stumped:"전혀 모르겠네요.",sorry:"무슨 그림인지 모르겠네요.",cant_guess:"그리기 시작하셔야 뭔지 알아맞힐 수 있어요.",start_drawing:"그리기를 시작하세요.",draw:"%(word) 그리기",what_it_saw:"신경망이 낙서 %(num_correct)개를 맞췄습니다. <br>하지만 %(num_wrong)개는 알아보지 못했어요. <br>낙서를 선택하여 신경망이 무엇으로 인식했는지 알아보세요.",how:"신경망이 낙서 %(num_correct)개를 맞췄어요. <br>낙서를 선택하여 신경망이 그림을 어떻게 맞췄는지 알아보세요.",correct_match:"정확하게 일치한 그림",closest_match:"가장 비슷한 그림",learned_by_example:"%(word)의 모양을 신경망이 어떻게 알 수 있었을까요?<br> 신경망은 다른 사람들이 그린 다음과 같은 예를 보고 학습했습니다.",what_does_it_think:"신경망은 %(word)이(가) 어떻게 생겼다고 생각할까요?<br> 신경망은 다른 사람들이 그린 다음과 같은 예를 보고 학습했습니다.",share:"신경망이 학습을 통해 내가 그린 낙서를 인식할 수 있을까요? 알아보려면 Quick, Draw를 플레이해 보세요.",share_portfolio:"저는 다음과 같은 여섯 개의 그림을 그렸고, 신경망이 그중 %(num_correct)개를 맞췄어요.",share_portfolio_desc:"여러분의 그림은 몇 개나 맞출 수 있을까요?",preparing:"공유 준비 중...",communication_error:"게임 서버와 통신하는 중에 문제가 발생했습니다.",try_again:"다시 시도",share_error:"공유를 준비하는 중에 문제가 발생했습니다.",reload:"새로고침",well_drawn:"잘 그리셨어요!",oops:"이런!",none:"없음",one:"1",two:"2",three:"3",four:"4",five:"5",all:"모두",popup_share:"공유",popup_share_ready:"공유 준비 완료"},pt_BR:{i_see:"Eu vejo",or:"ou",oh_i_know:"Já sei! É %(word).",drawing:"Desenho",something_else:"Nossa rede neural viu algo diferente em todos os seus desenhos. Selecione um deles para saber o que ela identificou.",no_clue:"Não faço ideia do que você está desenhando.",not_sure:"Não sei bem o que é isso.",stumped:"Não faço ideia.",sorry:"Desculpe, não consegui adivinhar.",cant_guess:"Não posso adivinhar o que você está desenhando se você não desenhar.",start_drawing:"Comece a desenhar.",draw:"Desenhe: %(word)",what_it_saw:"Nossa rede neural adivinhou %(num_correct) dos seus desenhos. <br>Mas ela viu algo diferente em %(num_wrong) deles. <br>Selecione um para saber o que foi identificado.",how:"Nossa rede neural adivinhou %(num_correct) dos seus desenhos. <br>Selecione um deles para ver como ela fez isso.",correct_match:"Correspondência correta",closest_match:"correspondência mais próxima",learned_by_example:"Como ela sabe com o que %(word) se parece?<br> Ela aprendeu olhando estes exemplos desenhados por outras pessoas.",what_does_it_think:"Com o que ela acha que %(word) se parece?<br> Ela aprendeu olhando estes exemplos desenhados por outras pessoas.",share:'Será que uma rede neural pode aprender a reconhecer seus desenhos? Jogue "Rápido, desenhe!" para descobrir.',share_portfolio:"Fiz estes seis desenhos. Uma rede neural adivinhou %(num_correct) deles corretamente.",share_portfolio_desc:"Quantos dos seus desenhos ela consegue adivinhar?",preparing:"Preparando para compartilhar…",communication_error:"Algo deu errado na comunicação com o servidor do jogo.",try_again:"Tente novamente",share_error:"Algo deu errado na hora de compartilhar",reload:"Atualizar",well_drawn:"Bom trabalho!",oops:"ops",none:"nenhum",one:"um",two:"dois",three:"três",four:"quatro",five:"cinco",all:"todos",popup_share:"Compartilhar",popup_share_ready:"Tudo pronto para compartilhar"},pt_PT:{i_see:"Estou a ver",or:"ou",oh_i_know:"Já sei, é %(word)!",drawing:"Desenho",something_else:"A nossa rede neural viu algo diferente em todos os seus rabiscos. Selecione um para ver o quê.",no_clue:"Não faço ideia do que está a desenhar!",not_sure:"Não sei bem o que é.",stumped:"Estou confuso.",sorry:"Não consegui adivinhar.",cant_guess:"Não consigo adivinhar o que está a desenhar se não desenhar!",start_drawing:"Está na hora de começar a desenhar.",draw:"Desenhe: %(word)",what_it_saw:"A nossa rede neural reconheceu %(num_correct) dos seus rabiscos. <br>Contudo, viu algo diferente no(s) outro(s) %(num_wrong). <br>Selecione um para ver o quê.",how:"A nossa rede neural reconheceu %(num_correct) dos seus rabiscos. <br>Selecione um para ver como o fez.",correct_match:"Correspondência certa",closest_match:"correspondência mais próxima",learned_by_example:"Como sabe qual é o aspeto de %(word)?<br> Aprendeu ao olhar para estes exemplos desenhados por outras pessoas.",what_does_it_think:"Com o que acha que %(word) se parece?<br> Aprendeu ao olhar para estes exemplos desenhados por outras pessoas.",share:"Uma rede neural consegue aprender a reconhecer os seus rabiscos? Jogue Quick, Draw para descobrir!",share_portfolio:"Criei estes seis rabiscos. Uma rede neural adivinhou %(num_correct) deles corretamente.",share_portfolio_desc:"Quantos dos seus consegue adivinhar?",preparing:"A preparar para partilhar...",communication_error:"Lamentamos, mas ocorreu um erro ao comunicar com o servidor do jogo.",try_again:"Tentar novamente",share_error:"Lamentamos, mas ocorreu um erro ao preparar para partilhar.",reload:"Atualizar",well_drawn:"Bem desenhado!",oops:"ups!",none:"nenhum",one:"um",two:"dois",three:"três",four:"quatro",five:"cinco",all:"todos",popup_share:"Partilhar",popup_share_ready:"Pronta a partilhar"},ru:{i_see:"Может, это",or:"или",oh_i_know:"Это же %(word)!",drawing:"Рисунок",something_else:"Ни на одном из ваших рисунков нейронная сеть не распознала то, что вы хотели изобразить. Нажмите на любой из них и посмотрите, что она увидела.",no_clue:"Даже не догадываюсь, что вы рисуете.",not_sure:"Ума не приложу, что это.",stumped:"Я в замешательстве.",sorry:"Увы, у меня нет никаких идей.",cant_guess:"Я не смогу угадать, если вы не будете рисовать.",start_drawing:"Попробуйте что-нибудь нарисовать.",draw:"Нарисуйте этот предмет: %(word)",what_it_saw:"Нейронная сеть верно угадала, что изображено на %(num_correct) из ваших рисунков.<br>Но на остальных рисунках (%(num_wrong)) она распознала другие предметы.<br>Нажмите на любой из них и посмотрите, что она увидела.",how:"Нейронная сеть верно угадала, что изображено на %(num_correct) из ваших рисунков.<br>Выберите любой из них, чтобы узнать, как ей это удалось.",correct_match:"Правильная догадка",closest_match:"наиболее точная догадка",learned_by_example:"Нейронная сеть научилась выбирать картинки, на которых есть %(word),<br>изучая рисунки, созданные другими пользователями.",what_does_it_think:"Нейронная сеть узнала, на каких картинках может быть %(word),<br>изучая рисунки, созданные другими пользователями.",share:"Научите нейронную сеть распознавать рисунки. Просто играйте в Quick, Draw!",share_portfolio:"Нейронной сети удалось верно угадать, что изображено на %(num_correct) из шести моих рисунков.",share_portfolio_desc:"Сколько ваших рисунков она сможет распознать?",preparing:"Подготовка к отправке…",communication_error:"Не удалось связаться с сервером",try_again:"Повторить попытку",share_error:"Ошибка при подготовке к отправке",reload:"Обновить",well_drawn:"Отличный рисунок!",oops:"Ошибка",none:"нет",one:"один",two:"два",three:"три",four:"четыре",five:"пять",all:"все",popup_share:"Опубликовать",popup_share_ready:"Готово к публикации"},zh_CN:{i_see:"这是：",or:"也可能是",oh_i_know:"我知道了，这是%(word)！",drawing:"涂鸦",something_else:"我们的神经网络试图辨识你画的涂鸦内容，但全都猜错了。你可以选择其中一幅涂鸦，看看神经网络究竟辨识出什么。",no_clue:"我看不出来你画了什么！",not_sure:"我不确定你画了什么。",stumped:"我被考倒了。",sorry:"很抱歉，我猜不出这是什么。",cant_guess:"如果你不画，我就没办法猜了！",start_drawing:"开始画吧。",draw:"请画出：%(word)",what_it_saw:"我们的神经网络正确猜出了你画的 %(num_correct) 幅涂鸦内容，<br>但无法辨识另外 %(num_wrong) 幅涂鸦。<br>你可以选择其中一幅涂鸦，看看神经网络究竟辨识出什么。",how:"我们的神经网络正确猜出了你画的 %(num_correct) 幅涂鸦内容。<br>你可以选择其中一幅涂鸦，看看神经网络究竟辨识出什么。",correct_match:"猜中",closest_match:"最接近的结果",learned_by_example:"为什么神经网络知道%(word)长什么样子？<br>因为它会观察其他用户画的这些涂鸦示例，并从中进行学习。",what_does_it_think:"神经网络认为%(word)长什么样子？<br>它会观察其他用户画的这些涂鸦示例，并从中进行学习。",share:"神经网络能学会辨识你的涂鸦吗？快来玩“快速涂鸦”找出答案吧！",share_portfolio:"我画了这 6 幅涂鸦，而神经网络正确猜出了其中 %(num_correct) 幅。",share_portfolio_desc:"你有多少幅涂鸦能被猜对呢？",preparing:"正在准备分享…",communication_error:"抱歉！与游戏服务器通信时出错！",try_again:"重试",share_error:"抱歉！准备分享时出错",reload:"重新加载",well_drawn:"画得很棒！",oops:"糟糕",none:"无",one:"一",two:"二",three:"三",four:"四",five:"五",all:"全部",popup_share:"分享",popup_share_ready:"可供分享"},zh_HK:{i_see:"我看到",or:"或者",oh_i_know:"哦，我知道了，這是%(word)！",drawing:"繪圖",something_else:"我們的神經網絡在您所有塗鴉中都看到其他東西。請選取其中一幅，瞭解它看到什麼。",no_clue:"我完全猜不到您在畫什麼！",not_sure:"我不肯定這是什麼。",stumped:"我被考起了。",sorry:"抱歉，我猜不到。",cant_guess:"如果您什麼都不畫，我便無法猜中！",start_drawing:"開始繪畫吧。",draw:"請繪畫：%(word)",what_it_saw:"我們的神經網絡猜中了 %(num_correct) 幅塗鴉，<br>但在其餘 %(num_wrong) 幅中看到其他東西。<br>請選取其中一幅，瞭解它看到什麼。",how:"我們的神經網絡猜中了 %(num_correct) 幅塗鴉。<br>請選取其中一幅，瞭解它如何猜中。",correct_match:"正確的比對結果",closest_match:"最接近的比對結果",learned_by_example:"神經網絡如何知道%(word)的樣子是什麼？<br>它觀察別人繪畫的例子，並從中學習。",what_does_it_think:"神經網絡認為%(word)的樣子是什麼？<br>它觀察別人繪畫的例子，並從中學習。",share:"神經網絡能否學會辨識您的塗鴉？立即暢玩 Quick Draw 找出答案！",share_portfolio:"我畫了這六幅塗鴉，而神經網絡猜中了 %(num_correct) 幅。",share_portfolio_desc:"它能猜中您多少幅繪圖？",preparing:"正在準備分享…",communication_error:"抱歉！與遊戲伺服器通訊時發生錯誤！",try_again:"再試一次",share_error:"抱歉！準備分享時發生錯誤",reload:"重新載入",well_drawn:"畫得很好！",oops:"抱歉",none:"無",one:"一",two:"二",three:"三",four:"四",five:"五",all:"全部",popup_share:"分享",popup_share_ready:"已準備好分享"},zh_TW:{i_see:"這是",or:"或",oh_i_know:"我知道了，這是%(word)！",drawing:"塗鴉",something_else:"我們的類神經網路嘗試辨識你畫了什麼，但全都猜錯了。點選下面的塗鴉即可查看類神經網路的答案。",no_clue:"我看不出來你畫了什麼！",not_sure:"我不確定你畫了什麼。",stumped:"我被考倒了。",sorry:"很抱歉，我猜不出這是什麼。",cant_guess:"如果你不畫，我就沒辦法猜了！",start_drawing:"開始畫吧。",draw:"請畫出：%(word)",what_it_saw:"我們的類神經網路能辨識出你畫的 %(num_correct)塗鴉內容。<br>不過，它沒猜中另外 %(num_wrong)畫的是什麼。<br>選取任一塗鴉即可查看類神經網路的答案。",how:"我們的類神經網路能辨識出你畫的 %(num_correct)塗鴉內容。<br>選取任一塗鴉即可查看類神經網路的辨識過程。",correct_match:"正確的比對結果",closest_match:"最接近的比對結果",learned_by_example:"類神經網路是如何掌握%(word)的外觀模樣？<br>它會參考其他人畫的所有範例，並從中學習。",what_does_it_think:"類神經網路如何判斷%(word)的外觀模樣？<br>它會參考其他人畫的所有範例，並從中學習。",share:"類神經網路能學會辨識你的塗鴉嗎？快來玩 Quick, Draw 找出答案吧！",share_portfolio:"我畫了這 6 幅塗鴉，而類神經網路猜對了 %(num_correct)塗鴉的內容。",share_portfolio_desc:"如果是你的塗鴉，類神經網路能猜對幾幅呢？",preparing:"正在準備分享...",communication_error:"很抱歉，與遊戲伺服器連線時出了點狀況！",try_again:"再試一次",share_error:"很抱歉，準備分享時出了點狀況",reload:"重新載入",well_drawn:"畫得好！",oops:"糟糕",
none:"0 幅",one:"1 幅",two:"2 幅",three:"3 幅",four:"4 幅",five:"5 幅",all:"全部",popup_share:"分享",popup_share_ready:"現在可與他人分享"}},_translations_instance=null,Translations=function(){function e(n){return classCallCheck(this,e),_translations_instance||(this.langCode=n.replace("-","_"),_translations_instance=this,this.translations={},$.ajax({url:"/api/locale?code="+this.langCode,method:"GET",complete:function(e){var n;n=e.responseText,n=n.replace(")]}',",""),n=JSON.parse(n),this.translations=n}.bind(this)})),_translations_instance}return createClass(e,[{key:"get",value:function(e){return this.translations[e]?this.translations[e]:"en_US"===this.getLocale()&&e}},{key:"getLocale",value:function(){return this.langCode}},{key:"getPhrase",value:function(e,n){var t;return t=phrases[this.langCode]&&phrases[this.langCode][e]?phrases[this.langCode][e]:phrases.en_US[e],n&&_.each(n,function(e){t=t.replace(/%\(.*?\)/,e)}),t}}]),e}(),_popup_instance=null,PopupView=function(e){function n(){var e;classCallCheck(this,n);var t=possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.translations=new Translations($("html").attr("lang")),_popup_instance||(_popup_instance=t,t.popup_quit_view=$("#popup-quit").hide(),t.popup_message_view=$("#popup-message").hide()),e=_popup_instance,possibleConstructorReturn(t,e)}return inherits(n,e),createClass(n,[{key:"showQuitPopup",value:function(){var e=this;return new Promise(function(n,t){e.popup_quit_view.show(),e.popup_quit_view.find("#popup-quit-cancel").off("click").on("click",function(){e.popup_quit_view.hide(),t()}),e.popup_quit_view.find("#popup-quit-quit").off("click").on("click",function(){e.popup_quit_view.hide(),n()})})}}],[{key:"showErrorPopup",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Reload";return new Promise(function(t){_popup_instance.popup_message_view.show();var r=_popup_instance.popup_message_view.find("#popup-message-text");r.html(e),ShuffleHandwrittenText(r);var o=_popup_instance.popup_message_view.find("#popup-message-button");o.show(),o.find("span").html(n),o.off("click").on("click",function(){_popup_instance.popup_message_view.hide(),t()})})}},{key:"showSharingLoadingPopup",value:function(e,n){var t=new Translations($("html").attr("lang"));_popup_instance.popup_message_view.show();var r=_popup_instance.popup_message_view.find("#popup-message-text");r.html(e),ShuffleHandwrittenText(r);var o=_popup_instance.popup_message_view.find("#popup-message-button");return o.hide(),function(){return new Promise(function(e,a){n?(o.show(),o.find("span").html(t.getPhrase("popup_share")),r.html(t.getPhrase("popup_share_ready")),ShuffleHandwrittenText(r),_popup_instance.popup_message_view.off("click").on("click",function(){_popup_instance.popup_message_view.hide(),a()}),o.off("click").on("click",function(){_popup_instance.popup_message_view.hide(),e()})):(_popup_instance.popup_message_view.hide(),e())})}}}]),n}(EventEmitter);new PopupView;var __currentuid,Sharing=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"siteShareText",value:function(){return new Translations($("html").attr("lang")).getPhrase("share")}},{key:"siteShareHashtags",value:function(){return"#aiexperiments #quickdraw"}},{key:"portfolioShareTitle",value:function(e){var n=_.reduce(e,function(e,n){return e+n.recognized},0),t=new Translations($("html").attr("lang")),r=["none","one","two","three","four","five","all"];return t.getPhrase("share_portfolio",[r[n]])}},{key:"portfolioShareDescription",value:function(){return new Translations($("html").attr("lang")).getPhrase("share_portfolio_desc")}},{key:"siteShareUrl",value:function(){return config.edition?"https://"+config.site_url+"/"+config.edition:"https://"+config.site_url}},{key:"siteShareLanguage",value:function(){var e=$("html").attr("lang"),n="";return"en-US"!==e&&(n="?locale="+e.replace("-","_")),n}},{key:"siteShareUrlSlug",value:function(e){return this.siteShareUrl()+"/shared/"+e+this.siteShareLanguage()}},{key:"openUrl",value:function(e){window.open(e,"","height=450, width=550, top="+($(window).height()/2-275)+", left="+($(window).width()/2-225)+", toolbar=0, location=0, menubar=0, directories=0, scrollbars=0")}},{key:"getShareUrl",value:function(e){var n=this;this.shareUrlCache||(this.shareUrlCache={});var t=_.pluck(e,"key"),r=t.join("");if(this.shareUrlCache[r])return Promise.resolve(this.shareUrlCache[r]);var o=new Translations($("html").attr("lang")),a=PopupView.showSharingLoadingPopup(o.getPhrase("preparing"),!0);return generateShareUrl(_.pluck(e,"key")).then(function(e){return n.shareUrlCache[r]=e,a().then(function(){return e})})}},{key:"ShareSiteTwitter",value:function(){e.openUrl("https://twitter.com/intent/tweet?text="+encodeURIComponent(e.siteShareText())+"&url="+e.siteShareUrl()),ga("send","event","Sharing","ShareSiteTwitter"),ga("send","social","twitter","share site",e.siteShareUrl())}},{key:"ShareSiteFacebook",value:function(){var n="https://www.facebook.com/dialog/feed?app_id=1657991857848712";n+="&display=popup&amp;caption=Share your portfolio",n+="&link="+e.siteShareUrl(),n+="&name=Quick, Draw!",n+="&caption=QUICKDRAW.WITHGOOGLE.COM",n+="&description="+e.siteShareText(),n+="&picture="+e.siteShareUrl()+"/static/shareimg.png",e.openUrl(n),ga("send","event","Sharing","ShareSiteFacebook"),ga("send","social","facebook","share site",e.siteShareUrl())}},{key:"ShareSiteG",value:function(){e.openUrl("https://plus.google.com/share?url="+e.siteShareUrl()),ga("send","event","Sharing","ShareSiteoG"),ga("send","social","g+","share site",e.siteShareUrl())}},{key:"SharePortfolioTwitter",value:function(n){e.getShareUrl(n).then(function(t){e.openUrl("https://twitter.com/intent/tweet?text="+encodeURIComponent(e.portfolioShareTitle(n))+"&url="+e.siteShareUrlSlug(t.slug)),ga("send","social","twitter","share portfolio",e.siteShareUrlSlug(t.slug))}).catch(function(){}),ga("send","event","Sharing","SharePortfolioTwitter")}},{key:"SharePortfolioFacebook",value:function(n){e.getShareUrl(n).then(function(t){var r="https://www.facebook.com/dialog/feed?app_id=1657991857848712";r+="&display=popup&amp;caption=Share your portfolio",r+="&link="+e.siteShareUrlSlug(t.slug),r+="&name="+e.portfolioShareTitle(n),r+="&caption=QUICKDRAW.WITHGOOGLE.COM",r+="&description="+e.portfolioShareDescription(),e.openUrl(r),ga("send","social","facebook","share portfolio",e.siteShareUrlSlug(t.slug))}).catch(function(){}),ga("send","event","Sharing","SharePortfolioFacebook")}},{key:"SharePortfolioG",value:function(n){e.getShareUrl(n).then(function(n){e.openUrl("https://plus.google.com/share?url="+e.siteShareUrlSlug(n.slug)),ga("send","social","g+","share portfolio",e.siteShareUrlSlug(n.slug))}).catch(function(){}),ga("send","event","Sharing","SharePortfolioG")}}]),e}(),_hw_instance=void 0,HandwritingAPI=function(){function e(){return classCallCheck(this,e),_hw_instance||(_hw_instance=this,this.count=0),_hw_instance}return createClass(e,[{key:"sendRequest",value:function(e,n){var t=this;this.count++;var r={input_type:0,requests:[{language:n.similar_drawings?"quickdraw-ink":"quickdraw"}]};return n.width&&(r.requests[0].writing_guide={width:n.width,height:n.height}),e&&(r.requests[0].ink=e),n.ink_hash&&(r.requests[0].ink_hash=n.ink_hash),n.feedback&&(r.requests[0].feedback=n.feedback,r.requests[0].select_type="feedback"),new Promise(function(e,o){$.post({url:n.feedback?config.handwriting_collector_url:config.handwriting_url,data:JSON.stringify(r),contentType:"application/json"}).fail(function(){o("Could not call classifier")}).done(function(r){"SUCCESS"==r[0]?n.feedback?e():e(t.parseResponse(r)):o("Could not process classifier response")})})}},{key:"parseResponse",value:function(e){var n=JSON.parse(e[1][0][3].debug_info.match(/SCORESINKS: (.+) Combiner:/)[1]);return _.map(n,function(n){return{word:n[0],score:n[1],id:e[1][0][0],neighbor:n[2]}})}}],[{key:"processSegments",value:function(e,n,t){return _hw_instance.sendRequest(e,{width:n,height:t})}},{key:"getSimilarDrawings",value:function(e,n,t){return e&&0!=e.length?_hw_instance.sendRequest(e,{similar_drawings:!0,width:n,height:t}):Promise.reject("No segments")}}]),e}();new HandwritingAPI;var ExperimentsController=function(){function e(){classCallCheck(this,e)}return createClass(e,null,[{key:"forceExperiment",value:function(n){e.forcedExperiment=n}},{key:"startNewGame",value:function(){delete e.activeExperiments,delete e.surveys,delete e.experimentName,delete e.forceWord,delete e.showSurveryAtRound;var n="";if(e.forcedExperiment&&(e.experimentName="explanationsPilot3",n=e.forcedExperiment,!(window.innerWidth<750))){switch(console.log("Running "+e.experimentName+" "+n),n){case"noExplanation":e.activeExperiments={conditions:n,hideNeighbors:!0,hideExplanation:!0,hideGallery:!0};break;case"neighborsAndGallery":e.activeExperiments={conditions:n,hideNeighbors:!1,hideExplanation:!1,hideGallery:!1};break;case"neighborsOnly":e.activeExperiments={conditions:n,hideNeighbors:!1,hideExplanation:!1,hideGallery:!0};break;case"galleryOnly":e.activeExperiments={conditions:n,hideNeighbors:!0,hideExplanation:!1,hideGallery:!1};break;default:return}e.showSurveryAtRound=1,e.forceWord={1:["paintbrush","toe","avocado"]},e.experimentName="explanationsPilot3",ga("send","event","Experiment","name",e.experimentName),ga("send","event","Experiment","conditions",e.activeExperiments.conditions),e.surveys=[["understanding","I understand what the system is thinking.","I understand what the system is thinking.",["Strongly disagree<br>1","2","3","Neutral<br>4","5","6","Strongly agree<br>7"]],["attribution","The system seems benevolent (kind and wants to do good).","The system seems benevolent (kind and wants to do good).",["Strongly disagree<br>1","2","3","Neutral<br>4","5","6","Strongly agree<br>7"]],["accuracy","The system seems capable.","The system seems capable.",["Strongly disagree<br>1","2","3","Neutral<br>4","5","6","Strongly agree<br>7"]],["attitude","The system recognized the drawing. In my opinion, this result was:","The system did not recognize the drawing. In my opinion, this result was: ",["Totally due to the recognizability of my drawing<br>1","2","3","About the same<br>4","5","6","Totally due to the system's level of capability<br>7"]]]}}},{key:"endExperiment",value:function(){delete e.activeExperiments}}]),e}(),GameRound=function(){function e(n,t){classCallCheck(this,e),this.word=n.en_challenge,this.localizedWord=n.challenge,this.startTime=new Date,this.recognized=!1,this.level=t,this.recognitions=[],this.width=0,this.height=0}return createClass(e,[{key:"resetTime",value:function(){this.startTime=new Date}},{key:"getElapsedTime",value:function(){return((new Date).getTime()-this.startTime.getTime())/1e3}}]),e}(),_cards_instance=null,CardsView=function(e){function n(){var e;classCallCheck(this,n);var t=possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.translations=new Translations($("html").attr("lang")),_cards_instance||(_cards_instance=t,t.newround_card=$("#newround-card").hide(),t.timesup_card=$("#timesup-card").hide(),t.about_card=$("#about-card").hide(),t.round_detail_card=$("#round-detail-card").hide(),t.survey_card=$("#survey-card").hide()),e=_cards_instance,possibleConstructorReturn(t,e)}return inherits(n,e),createClass(n,[{key:"showCard",value:function(e,n){e.isVisible=!0,e.show({duration:0,complete:function(){e.addClass("visible"),n&&n()}})}},{key:"hideCard",value:function(e,n){e.isVisible=!1,e.hasClass("visible")&&(e.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){e.hide(),e.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),n&&n()}),e.removeClass("visible"))}},{key:"showNewRoundCard",value:function(e){var n=this;e=_.defaults(e||{},{level:1,word:void 0,mode:void 0,onCardDismiss:function(){}});var t=_.once(function(){e.onCardDismiss&&e.onCardDismiss(),n.hideCard(n.newround_card,function(){})});this.showCard(this.newround_card),this.newround_card.find("#newround-skipped").hide(),this.newround_card.find("#newround-completed").hide(),this.newround_card.find("#newround-timesup").hide(),this.newround_card.find("#newround-default").show(),$("#challengetext-level").html(this.translations.getPhrase("drawing")+" "+e.level+"/"+config.num_rounds);var r=$("#challengetext-word");r.text(""+e.word),ShuffleHandwrittenText(r),setTimeout(function(){n.newround_card.on("click",function(){return t()}),n.newround_card.find("#button-newround-play").focus().off("click").on("click",function(){return t()})},1e3)}},{key:"showTimesUpCard",value:function(e,n){var t=this;ga("send","event","ShowEndCard"),this.hideCard(this.newround_card);var r=_.once(n),o=_.filter(e,function(e){return 1==e.recognized}).length;this.showCard(this.timesup_card);var a=this.timesup_card.find("#timesup-title");0==o?(a.text(this.translations.getPhrase("oops")),this.timesup_card.find("#timesup-subtitle").html(this.translations.getPhrase("something_else"))):(o<config.num_rounds?this.timesup_card.find("#timesup-subtitle").html(this.translations.getPhrase("what_it_saw",[o,config.num_rounds-o])):this.timesup_card.find("#timesup-subtitle").html(this.translations.getPhrase("how",[o])),a.text(this.translations.getPhrase("well_drawn"))),ShuffleHandwrittenText(a);var i=this.timesup_card.find("#timesup-drawings-wrapper");i.html("");for(var s=0;s<e.length;s++)!function(n){var r=e[n],o=$("<div>").addClass("timesup-round").addClass("button").addClass("button-drawing"),a=$("<button>").addClass("timesup-drawing"),s=$("<div>").addClass("timesup-drawing-neighbor"),u=$("<div>").addClass("timesup-drawing-status");e[n].recognized?u.text("✓ "+t.translations.get(r.word)):u.text("✕ "+t.translations.get(r.word)),a.on("click",function(){return t.showRoundDetails(r)}),a.append(u);var c=SVGUtils.createSvgFromSegments(r.drawing,180,120,{padding:25});a.append(c),o.append(a),o.append(s),i.append(o)}(s);this.timesup_card.find("#share_portfolio_twitter").off("click").on("click",function(){Sharing.SharePortfolioTwitter(e)}),this.timesup_card.find("#share_portfolio_facebook").off("click").on("click",function(){Sharing.SharePortfolioFacebook(e)}),this.timesup_card.find("#share_portfolio_g").off("click").on("click",function(){Sharing.SharePortfolioG(e)}),this.timesup_card.find(".button-close").off("click").on("click",function(){n&&r("CLOSE"),t.hideCard(t.timesup_card)}),$("#button-timesup-play").off("click").on("click",function(){n&&r("NEW_GAME"),t.hideCard(t.timesup_card)}),ga("send","screenview",{screenName:"TimesUpCard"})}},{key:"showRoundDetails",value:function(e,n){var t=this;return n=_.defaults(n||{},{nextButton:!1}),new Promise(function(r,o){ga("send","event","ShowRoundDetail"),t.round_detail_card.find("#gallery-wrapper").html(""),t.round_detail_card.find("#round-gallery").hide(),t.round_detail_card.find("#round-gallery-line").hide(),t.round_detail_card.find("#round-neighbors").hide(),t.round_detail_card.find("#round-neighbors-line").hide();var a=t.round_detail_card.find("#round-details-word");a.text(t.translations.get(e.word)),ShuffleHandwrittenText(a),e.recognized?(t.round_detail_card.find("#round-details-subtitle-not-recognized").hide(),t.round_detail_card.find("#round-details-subtitle-recognized").show(),t.round_detail_card.find("#round-details-not-recognized").hide(),t.round_detail_card.find("#round-details-recognized").show()):(t.round_detail_card.find("#round-details-subtitle-not-recognized").show(),t.round_detail_card.find("#round-details-subtitle-recognized").hide(),t.round_detail_card.find("#round-details-not-recognized").show(),t.round_detail_card.find("#round-details-recognized").hide());var i=SVGUtils.createSvgFromSegments(e.drawing,270,180,{padding:10,color:"rgba(0,0,0,1.00)"}),s=t.round_detail_card.find("#round-drawing").find(".round-drawing");s.html(""),s.append(i),ExperimentsController.activeExperiments?ExperimentsController.activeExperiments.hideNeighbors?ExperimentsController.activeExperiments.hideGallery||t.fetchAndShowGallery(e):t.fetchAndShowDrawingNeighbors(e).then(function(){ExperimentsController.activeExperiments.hideGallery||t.fetchAndShowGallery(e)}):t.fetchAndShowDrawingNeighbors(e).then(function(){return t.fetchAndShowGallery(e)}),t.round_detail_card.css({top:0}),t.round_detail_card.show(),HashManager.push("details",function(){t.round_detail_card.hide(),r()}),n.nextButton?(t.round_detail_card.find("#button-next").show(),t.round_detail_card.find("#button-back").hide()):(t.round_detail_card.find("#button-next").hide(),t.round_detail_card.find("#button-back").show()),t.round_detail_card.find("#button-back, #button-next").off("click").on("click",function(){t.round_detail_card.hide(),HashManager.pop("details"),r()})})}},{key:"fetchNeighbors",value:function(e){var n=this;return HandwritingAPI.getSimilarDrawings(e.drawing,e.width,e.height).then(function(t){var r=_.filter(t,function(e){return e.neighbor});return r=e.recognized?_.sortBy(r,function(n){return n.word==e.word?0:1}):_.filter(r,function(n){return n.word!=e.word}),r=_.filter(r,function(e){return n.translations.get(e.word)}),r=_.first(r,3)}).catch(function(){return[]})}},{key:"fetchAndShowDrawingNeighbors",value:function(e){var n=this,t=this.round_detail_card.find("#round-neighbors").hide(),r=this.round_detail_card.find("#round-neighbors-line").hide();return this.fetchNeighbors(e).then(function(t){if(0==t.length)throw new Error("No neighbors");for(var r=0;r<3;r++)if(t.length>r){n.round_detail_card.find("#round-detail-"+(r+1)).show();var o=n.round_detail_card.find("#round-detail-"+(r+1)),a=o.find(".round-detail-score"),i=o.find(".round-detail-word"),s=o.find(".round-detail-image"),u=o.find(".round-detail-image-neighbor");s.html(""),u.html(""),i.text(n.translations.get(t[r].word)),ShuffleHandwrittenText(i),0==r&&(e.word==t[r].word?a.text(n.translations.getPhrase("correct_match")):a.text(n.translations.getPhrase("closest_match")));var c=SVGUtils.createSvgFromSegments(e.drawing,270,130,{padding:10,color:"rgba(0,0,0,0.15)"});s.append(c);var l=SVGUtils.createSvgFromSegments(t[r].neighbor,270,130,{padding:10,order:1});u.append(l)}else n.round_detail_card.find("#round-detail-"+(r+1)).hide()}).then(function(){t.fadeIn(100),r.fadeIn(100)}).catch(function(){})}},{key:"fetchAndShowGallery",value:function(e){var n=this.round_detail_card.find("#round-gallery").hide(),t=this.round_detail_card.find("#round-gallery-line").hide(),r=this.translations.get(e.word),o=this.round_detail_card.find("#gallery-wrapper");o.html("");var a=this.round_detail_card.find("#gallery-title");e.recognized?a.html(this.translations.getPhrase("learned_by_example",[r])):a.html(this.translations.getPhrase("what_does_it_think",[r]));var i=!1;return fetchGallery(e.word).then(function(e){for(var n=0;n<e.length;n++){var t=e[n].image,r=$("<div>").addClass("gallery-drawing").addClass("drawing");o.append(r);var a=SVGUtils.createSvgFromSegments(JSON.parse(t),180,120,{padding:10});r.append(a)}e.length>0&&(i=!0)}).then(function(){i&&(n.fadeIn(100),t.fadeIn(100))}).catch(function(){})}},{key:"showAbout",value:function(){var e=this;this.showCard(this.about_card),this.about_card.find(".button-close").off("click").on("click",function(){e.hideCard(e.about_card,function(){var e=$("#about-card iframe"),n=e.attr("src");e.attr("src","").attr("src",n)})})}},{key:"showSurvey",value:function(e){var n=this;return new Promise(function(t,r){var o=n.survey_card.find("#survey-content"),a=n.survey_card.find("#survey-error");a.hide(),o.html("");for(var i=0,s=0,u=[],c=!1,l=function(t,r,a,l){var d=$("<div>").addClass("card-text");if(e){var h=$("<span>").text(r).addClass("survey-question");d.append(h)}else{var p=$("<span>").text(a).addClass("survey-question");d.append(p)}var g=$("<div>").addClass("survey-group");o.append(d),o.append(g);for(var _=0;_<l.length;_++){var w=$("<div>").addClass("survey-input"),m=$("<label>").attr("for","survey-"+t+"-radio-"+(_+1)).html(l[_]),f=$("<input>").attr("id","survey-"+t+"-radio-"+(_+1)).attr("type","radio").attr("name","survey-"+t).attr("value",_+1);w.append(m),w.append(f),g.append(w),f.on("click",function(){s=i-$(".survey-group:not(:has(:radio:checked))").length,0==$(".survey-group:not(:has(:radio:checked))").length&&(n.survey_card.find("#button-next").css("filter","initial"),c=!0)})}u.push(t),i++},d=0;d<ExperimentsController.surveys.length;d++)l.apply(void 0,toConsumableArray(ExperimentsController.surveys[d]));n.survey_card.css({top:0}),n.survey_card.show(),n.survey_card.find("#survey-skip-button").off("click").on("click",function(){n.survey_card.hide(),ExperimentsController.endExperiment(),r()}),n.survey_card.find("#button-next").css("filter","grayscale(100%)"),n.survey_card.find("#button-next").focus().off("click").on("click",function(){if(c){for(var e={},r=0;r<i;r++){var o=document.querySelector('input[name="survey-'+u[r]+'"]:checked'),s=void 0;s=o?o.value:-1,e["surveyAnswer"+(r+1)]=s}e.surveyHasPlayedBefore=n.survey_card.find("#survey-previously-played").is(":checked"),n.survey_card.hide(),t(e)}else a.show()}),n.survey_card.get(0).scrollTop=0})}}]),n}(EventEmitter),SplashView=function(e){function n(){classCallCheck(this,n);var e,t,r=window.navigator.userAgent,o=r.indexOf("MSIE "),a=$("#select-locale"),i=possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return i.elm=$("#splashview").hide(),$("#share_twitter").on("click",function(){Sharing.ShareSiteTwitter()}),$("#share_facebook").on("click",function(){Sharing.ShareSiteFacebook()}),$("#share_g").on("click",function(){Sharing.ShareSiteG()}),t=$("html").attr("lang").replace("-","_"),o>0||navigator.userAgent.match(/Trident.*rv\:11\./)?(a.val(t),a.css({visibility:"visible",marginBottom:15})):(e=new Dropkick("#select-locale"),e.select(t)),a.on("change",function(){var e;e=$(this).val(),ga("send","event","Language","pick",e),window.location=window.location.origin+window.location.pathname+"?locale="+e}),i}return inherits(n,e),createClass(n,[{key:"enableButtons",value:function(){var e=this;$("#button-play").on("click",function(){e.emit("START_GAME"),e.disableButtons(),document.getElementById("beep").load()}),$("#button-play-freeplay").on("click",function(){e.emit("START_GAME_FREEPLAY"),e.disableButtons()}),$("#button-about").on("click",function(){(new CardsView).showAbout()})}},{key:"disableButtons",value:function(){$("#button-play").off("click"),$("#button-play-freeplay").off("click"),$("#button-about").off("click")}},{key:"showView",value:function(){this.enableButtons(),this.elm.show()}},{key:"hideView",value:function(){this.disableButtons(),this.elm.hide()}}]),n}(EventEmitter),SpeechController=function(){function e(){classCallCheck(this,e),this.lang=$("html").attr("lang"),this.langMap={"en-US":"en-US","es-US":"es-MX",ar:"ar-SA",de:"de-DE",es:"es-ES",fr:"fr-FR",it:"it-IT",ja:"ja-JP",ko:"ko-KR","pt-BR":"pt-BR","pt-PT":"pt-PT",ru:"ru-RU","zh-CN":"zh-CN","zh-HK":"zh-HK","zh-TW":"zh-TW"},this.voiceLang=this.langMap[this.lang],this.supported=!1,this.synth=window.speechSynthesis,this.synth&&(this.supported=!0,this.synth.getVoices())}return createClass(e,[{key:"speak",value:function(e,n){var t=this;if(this.supported){e=e.replace(/'/gi,"’");var r=_.once(function(){n&&n()}),o=new SpeechSynthesisUtterance(e);o.addEventListener("end",function(){r()});var a=function e(){if(!t.synth.speaking)return void r();setTimeout(function(){e()},200)};setTimeout(function(){a()},500),o.rate=1.1,this.voice&&(o.voice=this.voice),o.lang=this.voiceLang,this.synth.speak(o)}}}]),e}(),_machine_instance=null,MachineView=function(){function e(){var n=this;return classCallCheck(this,e),_machine_instance||(_machine_instance=this,this.translations=new Translations($("html").attr("lang")),this.speech=new SpeechController,this.elmA=$("#machine-speechbubble-primary"),this.elmB=$("#machine-speechbubble-secondary"),this.resetTextAfterDelay=_.debounce(function(){return n.setText("...")},2e3),this.reset()),_machine_instance}return createClass(e,[{key:"reset",value:function(){this.setText("..."),this.guessesQueue=[],this.mentionedWords={},this.talkingGuesses=!1,this.recentMentionedWords=[]}},{key:"setText",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.elmA.text(e),this.elmB.text(n),this.resetTextAfterDelay()}},{key:"speak",value:function(e,n){var t=this;this.talking=!0,this.speech.speak(e,function(){t.talking=!1,n&&n()})}},{key:"speakAndWrite",value:function(e,n){this.setText(e),this.speak(e,n)}},{key:"readNextGuess",value:function(e){var n=this;if(this.talkingGuesses=!0,0==this.guessesQueue.length)return void(this.talkingGuesses=!1);e&&(this.recentMentionedWords=[]);var t=this.guessesQueue.shift(),r=this.translations.get(t),o=this.translations.getPhrase("or")+" "+r;e&&(o=this.translations.getPhrase("i_see")+" "+r);var a=void 0;a=r;var i=void 0;i=this.translations.getPhrase("i_see");var s=",";"ja"===this.translations.getLocale()&&(s="、");var u=i+" "+this.recentMentionedWords.join(s+" ");this.recentMentionedWords.length>0&&(u+=s+" "),this.setText(a,u),this.speak(o,function(){var e=u.length>30;n.readNextGuess(e)}),this.recentMentionedWords.push(r),this.mentionedWords[t]=1}},{key:"setResultWord",value:function(e){var n,t=this;n=this.translations.get(e),e=n||e,this.guessesQueue=[],this.speakAndWrite(this.translations.getPhrase("oh_i_know",[e])),setTimeout(function(){0==t.guessesQueue.length&&t.setText("...")},3e3)}},{key:"setGuesses",value:function(e){var n=this;if(!ExperimentsController.activeExperiments){this.guessesQueue=_.filter(e,function(e){return!_.has(n.mentionedWords,e)});var t=this.guessesQueue.length;return!this.talkingGuesses&&this.guessesQueue.length>0&&this.readNextGuess(!0),t}}}]),e}(),DrawingRecognitionControllerEvents={NEW_RECOGNITIONS:"NEW_RECOGNITIONS"},DrawingRecognitionController=function(e){function n(){classCallCheck(this,n);var e=possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.wordBlacklist=config.blacklist,e.machineView=new MachineView,e.processDrawingThrottle=_.throttle(function(n){return e.processDrawing(n)},1e3*config.max_api_rate,{leading:!1}),e.isRecognizing=!1,e.reset(),e}return inherits(n,e),createClass(n,[{key:"reset",value:function(){}},{key:"start",value:function(){this.reset(),this.isRecognizing=!0}},{key:"stop",value:function(){this.isRecognizing=!1}},{key:"processDrawing",value:function(e){var n=this,t=e.getSegments();_.reduce(t,function(e,n){return e+n[0].length},0)>10&&HandwritingAPI.processSegments(t,e.canvas.width,e.canvas.height).then(function(e){return n.processRecognitionResponse(e)})}},{key:"processRecognitionResponse",value:function(e){if(this.isRecognizing){var n=this.filterGuesses(e);this.emit(DrawingRecognitionControllerEvents.NEW_RECOGNITIONS,n)}}},{key:"filterGuesses",value:function(e){return _.filter(e,function(e){return e.score<config.handwriting_threshold})}},{key:"onDrawingUpdated",value:function(e){this.isRecognizing&&this.processDrawingThrottle(e)}}]),n}(EventEmitter),DrawingCanvas=function(e){function n(){classCallCheck(this,n);var e=possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));paper.install(window),e.canvas=document.getElementById("drawingCanvas"),paper.setup(e.canvas);var t,r=new Tool;return e.fgColor="black",e.bgColor="#68747a",e.paperpaths=[],e.paths=[],e.startTime=void 0,r.onMouseDown=function(n){t&&(t.selected=!1),t=new paper.Path({segments:[n.point],strokeColor:e.fgColor,strokeCap:"round",strokeWidth:7}),e.paperpaths.push(t),0==e.paths.length&&(e.startTime=new Date),e.paths.push([[n.point.x],[n.point.y],[e.currentTimeMs()]]),paper.view.draw()},r.onMouseDrag=function(n){t.add(n.point);var r=_.last(e.paths);(0==r[0].length||Math.abs(_.last(r[0])-n.point.x)>4||Math.abs(_.last(r[1])-n.point.y)>4)&&(r[0].push(n.point.x),r[1].push(n.point.y),r[2].push(e.currentTimeMs())),t.smooth(),paper.view.draw(),e.emit("DRAWING_UPDATED",e)},r.onMouseUp=function(n){t.smooth(),paper.view.draw(),e.emit("DRAWING_UPDATED",e),_.last(e.paths)[0].push(n.point.x),_.last(e.paths)[1].push(n.point.y),_.last(e.paths)[2].push(e.currentTimeMs())},$(window).resize(function(){e.resizeCanvas()}),$(window).on("orientationchange",function(){e.resizeCanvas()}),e.resizeCanvas(),e}return inherits(n,e),createClass(n,[{key:"currentTimeMs",value:function(){return this.startTime?new Date-this.startTime:0}},{key:"undo",value:function(){this.paperpaths.length>0&&(this.paperpaths[this.paths.length-1].remove(),this.paperpaths.splice(this.paperpaths.length-1,1),paper.view.draw())}},{key:"clear",value:function(){project.activeLayer.removeChildren(),this.paperpaths=[],this.resizeCanvas(),delete this.startTime,this.paths=[]}},{key:"getSegments",value:function(){return this.paths}},{key:"getJpg",value:function(){var e=document.createElement("canvas");e.width=640,e.height=this.canvas.height*(640/this.canvas.width);var n=e.getContext("2d");return n.beginPath(),n.rect(0,0,e.width,e.height),n.fillStyle=this.bgColor,n.fill(),n.drawImage(this.canvas,0,0,e.width,e.height),e.toDataURL("image/jpeg").replace("data:image/jpeg;base64,","")}},{key:"resizeCanvas",value:function(){var e=paper.view.center;if(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",paper.view.viewSize=new Size(this.canvas.width,this.canvas.height),this.paperpaths.length>0)for(var n=0;n<this.paperpaths.length;n++){var t=paper.view.center.x-e.x,r=paper.view.center.y-e.y;this.paperpaths[n].position.x+=t,this.paperpaths[n].position.y+=r}paper.view.draw()}},{key:"drawBg",value:function(){var e=new Rectangle(new Point(0,0),new Point(this.canvas.width,this.canvas.height)),n=new Path.Rectangle(e);n.fillColor=this.bgColor,n.sendToBack()}},{key:"drawAnchorPoint",value:function(){var e=new Path.Circle(paper.view.center,10);e.fillColor="red",e.sendToBack()}}]),n}(EventEmitter),GameView=function(e){function n(){classCallCheck(this,n);var e=possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));e.elm=$("#gameview"),e.popup=new PopupView,$("#button-undo").on("click",function(){e.emit("UNDO")}),$("#button-clear").on("click",function(){e.emit("CLEAR")});var t=_.throttle(function(){return e.emit("SKIP")},1e3,{trailing:!1});return $("#button-skip").on("click",function(){t()}),e.elm.find(".button-close").on("click",function(){e.popup.showQuitPopup().then(function(){e.emit("EXIT_GAME")}).catch(function(){})}),e}return inherits(n,e),createClass(n,[{key:"showTooltips",value:function(){var e=this.elm.find(".tooltip");e.fadeIn({duration:0}),e.each(function(){var e=this;setTimeout(function(){$(e).fadeOut({duration:800})},_.random(3e3,3400))})}},{key:"hideSkip",value:function(){$("#button-skip").hide()}},{key:"showSkip",value:function(){$("#button-skip").show()}}]),n}(EventEmitter),_clock_instance=null,Clock=function(e){function n(){var e;classCallCheck(this,n);var t=possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return _clock_instance||(_clock_instance=t,t.elm=$("#clock"),t.timeElm=$("#clock-time"),t.reset(),t.beepSound=document.getElementById("beep"),t.alertFlip=!1,t.started=!1),e=_clock_instance,possibleConstructorReturn(t,e)}return inherits(n,e),createClass(n,[{key:"reset",value:function(){this.totalTime=config.round_length,this.timeleft=config.round_length,this.started=!1,this.updateElm()}},{key:"startClock",value:function(){var e=this;this.started=!0,this.interval&&clearInterval(this.interval);var n=new Date;this.interval=setInterval(function(){var t=new Date;e.timeleft-=(t-n)/1e3,n=new Date,e.updateElm(),e.timeleft<=0&&(e.timeleft=0,e.pauseClock(),e.emit("TIMES_UP"))},100)}},{key:"pauseClock",value:function(){this.started=!1,clearInterval(this.interval),this.interval=null}},{key:"currentTime",value:function(){return this.totalTime-this.timeleft}},{key:"updateElm",value:function(){var e=Math.round(this.timeleft),n=Math.floor(e/60),t=e%60
;this.started&&(e<5?Math.round(10*this.timeleft)%2==0?this.alertFlip||(this.alertFlip=!this.alertFlip,this.beepSound.play().catch(function(){}),this.elm.addClass("text-blink")):this.alertFlip&&(this.alertFlip=!this.alertFlip,this.elm.removeClass("text-blink")):this.elm.removeClass("text-blink")),n=("00"+n).slice(-2),t=("00"+t).slice(-2),this.timeElm.text(n+":"+t)}}]),n}(EventEmitter),GameController=function(e){function n(){classCallCheck(this,n);var e=possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.translations=new Translations($("html").attr("lang")),e.recognitionController=new DrawingRecognitionController,e.clock=new Clock,e.drawingCanvas=new DrawingCanvas,e.gameView=new GameView,e.cardsView=new CardsView,e.machineView=new MachineView,e.drawingUntouched=!0,e.drawingCanvas.addListener("DRAWING_UPDATED",function(n){e.onDrawingUpdated(n)}),e.gameView.addListener("UNDO",function(){return e.drawingCanvas.undo()}),e.gameView.addListener("CLEAR",function(){return e.drawingCanvas.clear()}),e.gameView.addListener("SKIP",function(){return e.skipRound()}),e.gameView.addListener("EXIT_GAME",function(){return e.exitGame()}),e.clock.addListener("TIMES_UP",function(){return e.roundTimesUp()}),e.recognitionController.addListener(DrawingRecognitionControllerEvents.NEW_RECOGNITIONS,function(n){return e.onNewRecognitions(n)}),e.elm=$("#gameview").hide(),e.resetGameRounds(),e.newGuessesCounter=0,e}return inherits(n,e),createClass(n,[{key:"prepareNewGame",value:function(e){var n=this;if(this.preparedChallenge){if(e){var t=_.clone(this.preparedChallenge);this.preparedChallenge=void 0,e(t)}}else fetchNewRound(1,[],function(t){e?e(t):n.preparedChallenge=t})}},{key:"startNewGameWithChallenge",value:function(e,n){var t=this;n=_.defaults(n||{},{onCardDismiss:void 0}),ExperimentsController.startNewGame(),this.resetGameRounds(),this.level=1,this.completedLevels=0,this.clock.reset(),this.clock.startClock(),this.setStatus(0,config.num_rounds),this.startNewRoundWithChallenge(e,{onCardDismiss:n.onCardDismiss}),this.gameView.showTooltips(),this.gameView.addListener("CLEAR",function(){return t.machineView.reset()})}},{key:"setStatus",value:function(e,n){$("#game-status").text(this.translations.getPhrase("drawing")+" "+e+" / "+n)}},{key:"resetGameRounds",value:function(){this.presentedWords=[],this.previousRounds=[]}},{key:"startFreeplayGame",value:function(){var e=this;this.resetGameRounds(),this.recognitionController.start(),this.gameView.addListener("CLEAR",function(){return e.recognitionController.reset()})}},{key:"startNewRoundWithChallenge",value:function(e,n){var t=this;if(n=_.defaults(n||{},{showCard:!0,skipped:!1,timesUp:!1,onCardDismiss:function(){}}),this.pauseGame(),ExperimentsController.forceWord&&ExperimentsController.forceWord[String(this.level)]){var r=_.sample(ExperimentsController.forceWord[String(this.level)]);e.challenge=r,e.en_challenge=r}this.setStatus(this.level,config.num_rounds),this.pastRound=this.currentRound,this.currentRound=new GameRound(e,this.level),this.currentRound.width=this.drawingCanvas.canvas.width,this.currentRound.height=this.drawingCanvas.canvas.height,this.drawingUntouched=!0,this.presentedWords.push(this.currentRound.word);var o=function(){ga("send","event","Round","start",t.level),$("#topbar-text").text(t.translations.getPhrase("draw",[t.translations.get(t.currentRound.word)])),t.drawingCanvas.clear(),t.machineView.reset(),t.recognitionController.start(),t.clock.reset(),t.clock.startClock(),t.currentRound.resetTime()};if(n.showCard){var a="complete";if(n.skipped&&(a="skip"),n.timesUp&&(a="timesup"),1==this.level&&(a="first"),ExperimentsController.showSurveryAtRound==this.level-1&&!n.skipped)var i=new Date,s=0,u=this.cardsView.showRoundDetails(this.previousRounds[this.previousRounds.length-1],{nextButton:!0}).then(function(){s=((new Date).getTime()-i.getTime())/1e3}).then(function(){return t.cardsView.showSurvey(t.pastRound.recognized)}).then(function(e){return e.word=t.pastRound.word,e.experiment=ExperimentsController.experimentName,e.durationDrawing=Math.round(t.pastRound.duration),e.durationOnExplanationPage=Math.round(s),e.drawing=JSON.stringify(t.pastRound.drawing),e.recognized=t.pastRound.recognized,e.recognitionId=t.pastRound.recognitionId,e.condition=ExperimentsController.activeExperiments.conditions,e.locale=locale(),u=e,t.cardsView.fetchNeighbors(t.pastRound)}).then(function(e){return u.neighbors=JSON.stringify(e),submitSurvey(u)}).then(function(){return ExperimentsController.endExperiment()});this.cardsView.showNewRoundCard({level:this.level,word:this.currentRound.localizedWord,mode:a,onCardDismiss:function(){n.onCardDismiss(),o()}})}else o();this.level==config.num_rounds?this.gameView.hideSkip():this.gameView.showSkip()}},{key:"pauseGame",value:function(){this.clock.pauseClock(),clearTimeout(this.userNotDrawingTimeout)}},{key:"resumeGame",value:function(){this.clock.startClock()}},{key:"skipRound",value:function(){var e=this;ga("send","event","Round","skip",this.level),this.recognitionController.stop(),this.submitRoundResult({recognition:!1},function(n){e.previousRounds.push(e.currentRound),e.machineView.reset(),e.level<config.num_rounds?(e.level++,e.startNewRoundWithChallenge(n,{skipped:!0})):e.endGame()})}},{key:"roundRecognized",value:function(e){var n=this;ga("send","event","Round","recognized"),this.recognitionController.stop(),this.pauseGame(),this.machineView.setResultWord(this.currentRound.word),setTimeout(function(){n.submitRoundResult({recognition:e},function(e){n.previousRounds.push(n.currentRound),n.completedLevels++,n.level++,n.level-1==config.num_rounds?n.endGame():n.startNewRoundWithChallenge(e)})},1500)}},{key:"roundTimesUp",value:function(){var e=this;ga("send","event","Round","times_up",this.level),this.recognitionController.stop(),setTimeout(function(){e.machineView.speakAndWrite(e.translations.getPhrase(_.sample(config.timesUpSentences)))},500),this.submitRoundResult({recognition:!1},function(n){e.previousRounds.push(e.currentRound),e.level<config.num_rounds?(e.machineView.reset(),e.level++,e.startNewRoundWithChallenge(n,{skipped:!1,timesUp:!0})):e.endGame()})}},{key:"endGame",value:function(){var e=this;ga("send","event","Game","end",this.level),this.recognitionController.stop(),this.clock.pauseClock(),this.machineView.reset(),_.last(this.previousRounds)!=this.currentRound&&this.previousRounds.push(this.currentRound),this.cardsView.showTimesUpCard(this.previousRounds,function(n){"CLOSE"==n?e.exitGame():(ga("send","event","Game","end_restart"),e.prepareNewGame(function(n){e.startNewGameWithChallenge(n)}))})}},{key:"exitGame",value:function(){ga("send","event","Game","exit",this.level),this.pauseGame(),this.recognitionController.stop(),this.machineView.setGuesses([]),this.currentRound=void 0,this.clock.pauseClock(),this.emit("GAME_END")}},{key:"showView",value:function(){this.elm.show(),ga("send","screenview",{screenName:"Gameview"})}},{key:"hideView",value:function(){this.elm.hide()}},{key:"submitRoundResult",value:function(e,n){var t=this;this.currentRound.drawing=this.drawingCanvas.getSegments(),this.currentRound.recognized=!!e.recognition,this.currentRound.recognitionId=e.recognition?e.recognition.id:0,this.currentRound.duration=this.currentRound.getElapsedTime(),sendResult(this.currentRound,this.presentedWords).then(function(e){e.lastroundid&&(t.currentRound.key=e.lastroundid),n&&n(e)}).catch(function(){n&&n()})}},{key:"onNewRecognitions",value:function(e){var n=this;if(this.currentRound.recognitions=e,this.recognitionController.isRecognizing){var t=_.find(e,function(e){return(e.word==n.currentRound.word||_.contains(n.currentRound.synonyms,e.word))&&e.score<config.handwriting_recognition_threshold});if(this.currentRound&&t)this.roundRecognized(t);else if(this.currentRound){e=_.filter(e,function(e){var t,r;return t=e.word!=n.currentRound.word,r="en_US"===n.translations.getLocale()||n.translations.get(e.word),t&&r});var r=this.machineView.setGuesses(_.pluck(e,"word"));if(0==r?this.newGuessesCounter++:this.newGuessesCounter=0,this.newGuessesCounter>2){this.newGuessesCounter=0;var o=this.translations.getPhrase(_.sample(config.noNewGuessesSentences));this.machineView.speakAndWrite(o)}}}}},{key:"onDrawingUpdated",value:function(e){this.userNotDrawingTimeout&&clearTimeout(this.userNotDrawingTimeout),this.recognitionController.onDrawingUpdated(e),this.drawingUntouched&&(ga("send","event","Game","start_drawing","",Math.round(10*this.clock.currentTime())/10),this.drawingUntouched=!1,this.machineView.setText("..."))}}]),n}(EventEmitter),App=function(){function e(){var n=this;classCallCheck(this,e),config.edition=document.head.querySelector("[property=edition]").content,document.ontouchmove=function(e){e.touches&&e.touches.length>1&&e.preventDefault()},ShuffleHandwrittenText($(".handwritten")),$(".handwritten").removeClass("handwritten");var t=this.getUrlParameterByName("experiment");t&&ExperimentsController.forceExperiment(t),this.gameController=new GameController,this.gameController.prepareNewGame(),this.gameController.addListener("GAME_END",function(){return n.showSplashscreen()}),this.cardsView=new CardsView,this.splashView=new SplashView,this.splashView.showView(),this.splashView.addListener("START_GAME",function(){return n.startGame()}),this.splashView.addListener("START_GAME_FREEPLAY",function(){return n.startGameFreeplay()}),setTimeout(function(){n.getUrlParameterByName("dbg")&&n.cardsView.showTimesUpCard([{word:"bicycle",synonyms:[],presentationWord:"bicycle",startTime:"2016-08-08T15:46:37.826Z",recognized:!0,level:1,recognitions:[{word:"comb",score:"0.24282925",id:"110ecd3c54993f0e"},{word:"bicycle",score:"2.5853527",id:"110ecd3c54993f0e"},{word:"feather",score:"3.2277935",id:"110ecd3c54993f0e"},{word:"spoon",score:"3.2482364",id:"110ecd3c54993f0e"},{word:"boomerang",score:"3.3927391",id:"110ecd3c54993f0e"}],drawing:[[[626,621,616,610,604,599,592,586,580,575,572,569,566,566,565,564,564,563,561,560,558,558,555,553,551,550,549,548,546,538,531,527,524,521,515,511,506,501,495,492,486,483,480,476,472,469,466,463],[322,318,314,314,313,313,313,317,323,329,336,343,350,356,364,369,374,380,386,392,398,403,412,423,433,438,443,451,458,466,476,481,487,492,498,506,511,520,527,537,545,551,557,563,569,574,579,582],[0,128,161,196,232,265,298,331,364,398,432,465,499,533,567,584,601,618,636,653,670,687,703,738,772,789,806,840,1166,1222,1251,1268,1285,1302,1337,1355,1389,1423,1459,1493,1527,1560,1578,1612,1661,1695,1766,2048]]],recognitionId:""}])}),$(".hidden-on-startup").removeClass("hidden-on-startup"),("ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0)&&$("html").addClass("touch")}return createClass(e,[{key:"showSplashscreen",value:function(){this.gameController.hideView(),this.splashView.showView(),this.cardsView.hideCard(this.cardsView.newround_card),ga("send","screenview",{screenName:"Splashscreen"})}},{key:"startGame",value:function(){var e=this;this.gameController.prepareNewGame(function(n){e.gameController.startNewGameWithChallenge(n,{onCardDismiss:function(){e.splashView.hideView(),e.gameController.showView()}})})}},{key:"startGameFreeplay",value:function(){this.splashView.hideView(),this.gameController.showView(),this.gameController.startFreeplayGame()}},{key:"getUrlParameterByName",value:function(e){var n=window.location.href;e=e.replace(/[[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),r=t.exec(n);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}},{key:"redirectToSplash",value:function(){$("#newround-card").hide(),$("#timesup-card").hide(),$("#about-card").hide(),$("#round-detail-card").hide(),$("#survey-card").hide(),$("#popup-quit").hide(),$("#popup-message").hide(),this.showSplashscreen()}}]),e}(),app;$(document).ready(function(){app=new App}),function(e,n,t,r,o,a,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,a=n.createElement(t),i=n.getElementsByTagName(t)[0],a.async=1,a.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(a,i)}(window,document,"script",0,"ga"),ga("create","UA-85918250-1","auto"),ga("send","pageview"),ga("send","event","Language","load",new Translations($("html").attr("lang")).getLocale(),{nonInteraction:1});
